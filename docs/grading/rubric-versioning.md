# Версионирование рубрик

## Цели

- Прозрачность изменений критериев
- Воспроизводимость исторических оценок
- Управление совместимостью при изменении весов и логики

## Семантика версий

Используется семантическая схема `MAJOR.MINOR.PATCH`:

- MAJOR — несовместимые изменения структуры или смысл критериев
- MINOR — добавление новых критериев или атрибутов без изменения смысла существующих
- PATCH — корректировки описаний / орфографии / метаданных без влияния на вычисление

## Правила изменений

| Тип изменения | Требуемый bump | Пример |
|---------------|----------------|--------|
| Переименование критерия | MAJOR | CR5 → CR_CONTENT |
| Изменение веса критерия > ±10% | MINOR или MAJOR (если нарушает интерпретацию) | weight 0.2 → 0.35 |
| Добавление критерия | MINOR | + CR10 |
| Удаление критерия | MAJOR | remove CR7 |
| Исправление описания без смены смысла | PATCH | typo fix |
| Изменение агрегирующей формулы | MAJOR | weighted-sum → geometric |

## Сопоставление оценок

При переоценке (re-grade) старая оценка должна ссылаться на `(rubric_id, version)`.

### Принципы

- Никогда не перезаписывать прошлые версии
- Хранить рубрику inline вместе с Evaluation snapshot (denormalized)
- Поддерживать миграцию только вперёд (no downgrade)

## Миграции

Каталог [docs/grading/migrations/](/docs/grading/migrations/) (позже) для описательных файлов:

```text
<timestamp>__rubric_<id>__<from>_to_<to>.md
```

Содержимое: rationale, изменённые поля, потенциальное влияние на распределение баллов.

## Стабильность и деприкейт

- Помечать критерии устаревшими (deprecated=true) перед удалением (минимум одна MINOR версия)
- Собирать метрику использования критерия (процент влияния)

## Инварианты

- Сумма весов активных критериев = 1.0
- Идентификаторы критериев уникальны в рамках версии
- Запрещено удалять критерий и в той же версии добавлять другой с тем же смыслом под новым id

## Связанные процессы

- Публикация рубрики требует review (2+ approvals)
- Автоматический changelog генерируется из diff JSON

## Открытые вопросы

- Нужна ли поддержка alias для объединения близких критериев?
- Требуется ли хранение статистики распределения для каждой версии?
